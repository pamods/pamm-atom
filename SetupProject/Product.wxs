<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<Product Id="*" Name="PAMM" Language="1033" Version="1.3.0.0" Manufacturer="The PA Community" UpgradeCode="e77d9fc7-9cc0-497f-b461-19d61a3e2e26">
		<Package InstallerVersion="500" Compressed="yes" InstallPrivileges="limited"/>

		<MajorUpgrade DowngradeErrorMessage="A newer version of PAMM is already installed." />
		<MediaTemplate EmbedCab="yes" />

		<Feature Id="ProductFeature" Title="PAMM" Level="1">
			<ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="RegistryEntries" />
      <ComponentRef Id="ApplicationShortcutDesktop" /> 
    </Feature>

    <Icon Id="pamm.ico" SourceFile="pamm.ico"/>
    <Property Id="ARPPRODUCTICON" Value="pamm.ico" />
    
    <WixVariable Id="WixUILicenseRtf" Value="eula.rtf" />
    <Property Id="ApplicationFolderName" Value="pamm" />
    <Property Id="WixAppFolder" Value="WixPerUserFolder" />
    <UIRef Id="WixUI_PAMM" />
    
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="Run PAMM" />
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOX" Value="1" />
    <Property Id="WixShellExecTarget" Value="[#filBB8AA81B26491804CBCE8A77F9DD02E8]" />
    <CustomAction Id="LaunchApplication" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" />
	</Product>

	<Fragment>
		<Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="APPLICATIONFOLDER" Name="pamm" />
      </Directory>
		</Directory>
	</Fragment>

  <Fragment>
    <DirectoryRef Id="TARGETDIR">
      <Component Id="RegistryEntries" Guid="23cc3bb3-a7f6-4b40-9aae-c6fae21e7a92">
        <RegistryKey Root="HKCU" Key="Software\Classes\pamm">
          <RegistryValue Type="string" Value="URL:pamm Protocol"/>
          <RegistryValue Type="string" Name="URL Protocol" Value="" KeyPath="yes"/>
          <RegistryKey Key="DefaultIcon">
            <RegistryValue Type="string" Value="[APPLICATIONFOLDER]assets\img\favicon.ico"/>
          </RegistryKey>
          <RegistryKey Key="shell\open\command">
            <RegistryValue Type="string" Value="&quot;[APPLICATIONFOLDER]pamm.exe&quot; &quot;$1&quot;"/>
          </RegistryKey>
        </RegistryKey>
      </Component>
    </DirectoryRef>
  </Fragment>

  <Fragment>
    <DirectoryRef Id="TARGETDIR">
      <Directory Id="DesktopFolder" Name="Desktop">
        <Component Id="ApplicationShortcutDesktop" Guid="add09423-9105-497e-8937-6a237f466b28">
          <Shortcut Id="ApplicationDesktopShortcut"
             Name="PAMM"
             Target="[APPLICATIONFOLDER]pamm.exe"
             WorkingDirectory="APPLICATIONFOLDER"
             Icon="pamm.ico"/>
          <RegistryValue Root="HKCU" Key="Software\pamm" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
        </Component>
      </Directory>
    </DirectoryRef>
  </Fragment>
</Wix>